<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Page Title</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- <link rel="stylesheet" type="text/css" media="screen" href="main.css" /> -->
  <!-- <script src="node_modules/poly-decomp/build/decomp.js" type="text/javascript"></script> -->
  <!-- <script src="../node_modules/matter-js/build/matter.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.12.0/matter.js" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.js"></script>


  <script>
  </script>
  <!-- <script src="../data/points.js"></script> -->
</head>

<body>

</body>
<script>
  // module aliases
   var project = async () => {
    var Engine = Matter.Engine,
      Render = Matter.Render,
      World = Matter.World,
      Constraint = Matter.Constraint,
      Mouse = Matter.Mouse,
      MouseConstraint = Matter.MouseConstraint,
      Composite = Matter.Composite
    Composites = Matter.Composites,
      Body = Matter.Body,
      Bodies = Matter.Bodies;
    Vector = Matter.Vector;
    Vertices = Matter.Vertices;

    // create an engine
    var engine = Engine.create();
    // create a renderer
    var render = Render.create({
      element: document.body,
      engine: engine
    });
    var coins = ["BTC/USD", "LTC/USD", "ETH/USD", "XMR/USD", "LTC/BTC", "ETH/BTC", "XMR/BTC"];
    var tFrame = ["1m", "1h", "1D"];
    var points = [];
    async function pullCandleClose() {
      var queryURL = "https://api.bitfinex.com/v2/candles/trade:1D:tBTCUSD/hist";
      var points = [];
      var coin = '';
      var response = await fetch(queryURL);
      // console.log(response);
      var htmlString = await response.json();
      // console.log(htmlString);

          for (i = 0; i < 30; i++) {
            points.push(Math.floor(htmlString[i][2]));
            console.log(points[i]);
          }
          return points;
        }

    // console.log(await pullCandleClose);
    var path = await pullCandleClose();
    // console.log(path);
    var minValue = Math.min(path[0]);
    // console.log(minValue);
    // for (var i = 0; i < path.length; i++) {
    //   path[i] = path[i] - minValue;
    // }
    var maxValue = Math.max(path[0]);
    var lines = [];
    for (var i = 0; i < path.length - 1; i++) {
      var x = (i + (i + 1)) / 2 * 30; //*5 only used to span graph
      var y = 600 - ((path[i] + path[i + 1]) / 2 * (350 / maxValue)); //scaling to fit area
      // console.log(y);
      var adjacent = 1 * 30;
      var opposite = (path[i + 1] - path[i]) * (350 / maxValue);
      var angle = Math.atan(opposite / adjacent);
      // console.log(angle);
      var line = Bodies.rectangle(x, y, Math.sqrt(opposite ** 2 + adjacent ** 2), 1, {
        isStatic: true,
        angle: -angle
      });
      // World.add(engine.world, line);
      lines.push(line);
    }

    World.add(engine.world, lines);

    var trap = Bodies.trapezoid(180, 10, 80, 80, 1)
    // console.log(course);
    // console.log("this");
    World.add(engine.world, [trap]);
    // run the engine
    Engine.run(engine);
    // run the renderer
    Render.run(render);
  };
  project();
</script>

</html>
